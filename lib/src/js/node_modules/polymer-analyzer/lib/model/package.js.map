{"version":3,"sources":["model/package.ts"],"names":[],"mappings":"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","file":"package.js","sourcesContent":["/**\n * @license\n * Copyright (c) 2016 The Polymer Project Authors. All rights reserved.\n * This code may only be used under the BSD style license found at\n * http://polymer.github.io/LICENSE.txt\n * The complete set of authors may be found at\n * http://polymer.github.io/AUTHORS.txt\n * The complete set of contributors may be found at\n * http://polymer.github.io/CONTRIBUTORS.txt\n * Code distributed by Google as part of the polymer project is also\n * subject to an additional IP rights grant found at\n * http://polymer.github.io/PATENTS.txt\n */\nimport {Warning} from '../warning/warning';\n\nimport {Document, FeatureKinds} from './document';\nimport {Feature} from './feature';\nimport {Queryable} from './queryable';\n\n/**\n * Represents a queryable interface over all documents in a package/project.\n *\n * Results of queries will include results from all documents in the package, as\n * well as from external dependencies that are transitively imported by\n * documents in the package.\n */\nexport class Package implements Queryable {\n  private _documents: Set<Document>;\n  private _toplevelWarnings: Warning[];\n\n  constructor(documents: Iterable<Document>, warnings: Warning[]) {\n    const potentialRoots = new Set(documents);\n    this._toplevelWarnings = warnings;\n\n    // We trim down the set of documents as a performance optimization. We only\n    // need a set of documents such that all other documents we're interested in\n    // can be reached from them. That way we'll do less duplicate work when we\n    // query over all documents.\n    for (const doc of potentialRoots) {\n      for (const imprt of doc.getByKind('import')) {\n        // When there's cycles we can keep any element of the cycle, so why not\n        // this one.\n        if (imprt.document !== doc) {\n          potentialRoots.delete(imprt.document);\n        }\n      }\n    }\n    this._documents = potentialRoots;\n  }\n\n  getByKind<K extends keyof FeatureKinds>(kind: K): Set<FeatureKinds[K]>;\n  getByKind(kind: string): Set<Feature>;\n  getByKind(kind: string): Set<Feature> {\n    const result = new Set();\n    for (const doc of this._documents) {\n      addAll(result, doc.getByKind(kind));\n    }\n    return result;\n  }\n\n  getById<K extends keyof FeatureKinds>(kind: K, identifier: string):\n      Set<FeatureKinds[K]>;\n  getById(kind: string, identifier: string): Set<Feature>;\n  getById(kind: string, identifier: string): Set<Feature> {\n    const result = new Set();\n    for (const doc of this._documents) {\n      addAll(result, doc.getById(kind, identifier));\n    }\n    return result;\n  }\n\n  getOnlyAtId<K extends keyof FeatureKinds>(kind: K, identifier: string):\n      FeatureKinds[K]|undefined;\n  getOnlyAtId(kind: string, identifier: string): Feature|undefined;\n  getOnlyAtId(kind: string, identifier: string): Feature|undefined {\n    const results = this.getById(kind, identifier);\n    if (results.size > 1) {\n      throw new Error(\n          `Expected to find at most one ${kind} with id ${identifier} ` +\n          `but found ${results.size}.`);\n    }\n    return results.values().next().value || undefined;\n  }\n\n  /**\n   * Get all features for all documents in the project or their imports.\n   */\n  getFeatures(): Set<Feature> {\n    const result = new Set();\n    for (const doc of this._documents) {\n      addAll(result, doc.getFeatures(true));\n    }\n    return result;\n  }\n\n  /**\n   * Get all warnings in the project.\n   */\n  getWarnings(): Warning[] {\n    const result = new Set(this._toplevelWarnings);\n    for (const doc of this._documents) {\n      addAll(result, new Set(doc.getWarnings(true)));\n    }\n    return Array.from(result);\n  }\n}\n\nfunction addAll<T>(set1: Set<T>, set2: Set<T>): Set<T> {\n  for (const val of set2) {\n    set1.add(val);\n  }\n  return set1;\n}\n"]}